@model PersonalFinance.Models.Plaid
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<body>
    <!-- Wrapper-->
    <div class="wrapper">
        <!-- Header-->
        <!-- End header-->
        <!-- Main content-->
        <section>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="view-header">
                            <div class="header-icon">
                                <i class="pe page-header-icon pe-7s-cash"></i>
                            </div>
                            <div class="header-title">
                                <h3 class="m-b-xs">Welcome Back, Username</h3>
                                <small>
                                    Some friendly welcome text that let's the user know they are in great hands.
                                </small>
                            </div>
                        </div>
                        <hr>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="panel">
                            <div class="panel-body">
                                <h1 class="m-t-md m-b-xs" style="margin-top: 30px">
                                    <i class="pe pe-7s-global text-warning"> </i>
                                    $ 25,000 <span class="slight"><i class="fa fa-play fa-rotate-90 text-warning"> </i> -0.5%</span>
                                </h1>
                                <div class="small">
                                    <span class="c-white">Your Net Worth</span> Calculated as the totaled sum for all synced accounts as of [date].
                                </div>
                                <div class="m-t-sm">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <small class="c-white">
                                            </small>
                                            <div class="sparkline3"></div>
                                            <small class="slight">
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="panel panel-filled">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="panel-body h-200 list">
                                        <div class="stats-title pull-left">
                                            <h4>Goal Success</h4>
                                        </div>
                                        <div class="m-t-xl">
                                            <small>
                                                <span class="c-white">Great Job!</span> You're right on track with your yearly goal.
                                            </small>
                                        </div>

                                        <div class="progress m-t-xs full progress-small">
                                            <div style="width: 35%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="35" role="progressbar" class=" progress-bar progress-bar-warning">
                                                <span class="sr-only">35% Complete (success)</span>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <small class="stat-label">Year to Date Saved</small>
                                                <h4 class="m-t-xs">$ 250.30 <i class="fa fa-level-up text-warning"></i></h4>
                                            </div>
                                            <div class="col-md-6">
                                                <small class="stat-label">% To Target</small>
                                                <h4 class="m-t-xs">35 % <i class="fa fa-level-up c-white"></i></h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="panel-body">
                                        <div class="text-center slight">
                                        </div>
                                        <canvas id="singleBarOptions" height="100"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <div class="panel">
                            <div class="panel-body">
                                <div id="reportrange" class="pull-left" style="background: #404652; cursor: pointer; padding: 5px 10px; border: none; width: inherit">
                                    <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                                    <span></span> @Model.start_date - @Model.end_date <b class="caret"></b>
                                </div>
                            </div>
                        </div>
                    </div>
                    @if (Model.Transaction_list is null || Model.Transaction_list.Count == 0)
                    {
                        <div class="row">
                            <div class="col-md-8">
                                <div class="panel">
                                    <div class="panel-body">
                                        <h3>No Data Available For The Selected Timeframe!</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="row">
                            <div class="col-md-8">
                                <div class="panel">
                                    <div class="panel-body">
                                        <div class="table-responsive">
                                            <table id="myDataTable" class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Category</th>
                                                        <th>Description</th>
                                                        <th>Location</th>
                                                        <th>Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="panel panel-b-accent m-t-sm">
                                    <div class="panel-body text-center p-m">
                                        <h2 class="font-light">
                                            +280k downloads
                                        </h2>
                                        <small>New downloads from the last month.</small>
                                        <br />
                                        120,312 <span class="slight"><i class="fa fa-play fa-rotate-270 c-white"> </i> -22%</span>
                                        <div class="sparkline7 m-t-xs"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </section>
        <!-- End main content-->
    </div>
    <!-- End wrapper-->
    <!-- Vendor scripts -->
    @section Scripts {
        @Scripts.Render("~/bundles/jqueryval")
    }
    <script src="~/Content/vendor/jquery/dist/jquery.min.js"></script>
    <script src="~/Content/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="~/Content/vendor/sparkline/index.js"></script>
    <script src="~/Content/vendor/chart.js/dist/Chart.min.js"></script>

    <!-- App scripts -->
    <script src="~/Scripts/luna.js"></script>
    @Scripts.Render("~/bundles/jqueryval")

    <!--Date Picker Scripts-->
    <script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="~/Scripts/daterangepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="~/Content/daterangepicker.css" />
    <script type="text/javascript">
        $(function () {

            var start = @Model.start_date;
            var end = @Model.end_date;

            $('#reportrange').daterangepicker({

                startDate: start,
                endDate: end,

                ranges: {
                    'Today': [moment(), moment()],
                    'Week To Date': [moment().subtract(6, 'days'), moment()],
                    'Month To Date': [moment().startOf('month'), moment()],
                    'Year To Date': [moment().startOf('year'), moment()],
                    'One Year': [moment().subtract(12, 'month'), moment()]
                }

            });

            $('#reportrange').on('apply.daterangepicker', function (ev, picker) {

                 $.post('@Url.Action("Main","Dashboard")', {
                    dates: { start_date: picker.startDate.format("MM/DD/YYYY"), end_date: picker.endDate.format("MM/DD/YYYY") }
                }, function () {
                    window.location.reload(true);
                });
            });
        });
    </script>

    <!--DataTable Scripts-->
    <script src="~/Content/vendor/DataTables/datatables.min.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="~/Content/vendor/DataTables/dataTables.min.css" />
    <script>
        $(document).ready(function () {

    $('#myDataTable').dataTable({
        "bServerSide": true,
        "sAjaxSource": '@Url.Action("DataTableHandler", "Dashboard")',
        "bProcessing": true,
        "searching": false,
        "pagingType": "full_numbers",
        "aoColumns": [
                        { "sName": "Date" },
                        { "sName": "Category" },
                        { "sName": "Description" },
                        { "sName": "Location" },
                        { "sName": "Amount" }
                    ]
    });
});
    </script>

    <!--Chart Scripts-->
    <script>
        $(document).ready(function () {


            // Sparkline charts
            var sparklineCharts = function () {
                $(".sparkline").sparkline([20, 34, 43, 43, 35, 44, 32, 44, 52, 45], {
                    type: 'line',
                    lineColor: '#FFFFFF',
                    lineWidth: 3,
                    fillColor: '#404652',
                    height: 47,
                    width: '100%'
                });

                $(".sparkline13").sparkline([6, 2], {
                    type: 'pie',
                    sliceColors: ['#f7af3e', '#404652']
                });

                $(".sparkline7").sparkline([10, 34, 13, 33, 35, 24, 32, 24, 52, 35], {
                    type: 'line',
                    lineColor: '#FFFFFF',
                    lineWidth: 3,
                    fillColor: '#f7af3e',
                    height: 75,
                    width: '100%'
                });

                $(".sparkline1").sparkline([0, 6, 8, 3, 2, 4, 3, 4, 9, 5, 3, 4, 4, 5, 1, 6, 7, 15, 6, 4, 0], {
                    type: 'line',
                    lineColor: '#2978BB',
                    lineWidth: 3,
                    fillColor: '#2978BB',
                    height: 170,
                    width: '100%'
                });

                $(".sparkline3").sparkline([-8, 2, 4, 3, 5, 4, 3, 5, 5, 6, 3, 9, 7, 3, 5, 6, 9, 5, 6, 7, 2, 3, 9, 6, 6, 7, 8, 10, 15, 16, 17, 15], {

                    type: 'line',
                    lineColor: '#fff',
                    lineWidth: 3,
                    fillColor: '#393D47',
                    height: 70,
                    width: '100%'
                });

                $(".sparkline5").sparkline([0, 6, 8, 3, 2, 4, 3, 4, 9, 5, 3, 4, 4, 5], {
                    type: 'line',
                    lineColor: '#f7af3e',
                    lineWidth: 2,
                    fillColor: '#2F323B',
                    height: 20,
                    width: '100%'
                });
                $(".sparkline6").sparkline(amounts, {
                    type: 'bar',
                    barColor: '#f7af3e',
                    height: 20,
                    width: '100%'
                });

                $(".sparkline8").sparkline([4, 2], {
                    type: 'pie',
                    sliceColors: ['#f7af3e', '#404652']
                });
                $(".sparkline9").sparkline([3, 2], {
                    type: 'pie',
                    sliceColors: ['#f7af3e', '#404652']
                });
                $(".sparkline10").sparkline([4, 1], {
                    type: 'pie',
                    sliceColors: ['#f7af3e', '#404652']
                });
                $(".sparkline11").sparkline([1, 3], {
                    type: 'pie',
                    sliceColors: ['#f7af3e', '#404652']
                });
                $(".sparkline12").sparkline([3, 5], {
                    type: 'pie',
                    sliceColors: ['#f7af3e', '#404652']
                });
            };

            var sparkResize;

            // Resize sparkline charts on window resize
            $(window).resize(function () {
                clearTimeout(sparkResize);
                sparkResize = setTimeout(sparklineCharts, 100);
            });

            // Run sparkline
            sparklineCharts();


            // Flot charts data and options
            var data = @Html.Raw(Json.Encode(Session["BarChart"]));

            var dates = $.map(data, function (el) { return el.date });
            var amounts = $.map(data, function (el) { return el.amount });

            var globalOptions = {
                responsive: true,
                legend: {
                    labels: {
                        fontColor: "#90969D"
                    }
                },
                scales: {
                    xAxes: [{
                        display: false,
                        ticks: {
                            fontColor: "#90969D"
                        },
                        gridLines: {
                            color: "#37393F"
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            fontColor: "#90969D"
                        },
                        gridLines: {
                            color: "#37393F"
                        }
                    }]
                }
            };

            var singleBarData = {
                labels: dates,
                datasets: [
                    {
                        label: 'Net Transactions',
                        backgroundColor: 'transparent',
                        borderColor: "#f6a821",
                        borderWidth: 1,
                        data: amounts
                    }
                ]
            };

            var c4 = document.getElementById("singleBarOptions").getContext("2d");
            new Chart(c4, { type: 'bar', data: singleBarData, options: globalOptions });

        });
    </script>
</body>
